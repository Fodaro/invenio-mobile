<!--
    ## This file is part of Invenio.
    ## Copyright (C) 2012, 2013 CERN.
    ##
    ## Invenio is free software; you can redistribute it and/or
    ## modify it under the terms of the GNU General Public License as
    ## published by the Free Software Foundation; either version 2 of the
    ## License, or (at your option) any later version.
    ##
    ## Invenio is distributed in the hope that it will be useful, but
    ## WITHOUT ANY WARRANTY; without even the implied warranty of
    ## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    ## General Public License for more details.
    ##
    ## You should have received a copy of the GNU General Public License
    ## along with Invenio; if not, write to the Free Software Foundation, Inc.,
    ## 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
-->

<!--   jquery mobile pregenerated form   -->
<form name="search" class="main_search_form" data-role="none">
      <div data-role="none" class="ui-hide-label ui-field-contain ui-body ui-br"><label for="Author" class="ui-input-text">Author</label><div class="ui-input-search ui-shadow-inset ui-btn-corner-all ui-btn-shadow ui-icon-searchfield ui-body-c"><input type="text" data-role="none" data-type="search" name="Author" id="Author" value="" placeholder="Author" class="ui-input-text ui-body-c"><a href="#" class="ui-input-clear ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-fullsize ui-btn-icon-notext ui-input-clear-hidden" title="clear text" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-icon="delete" data-iconpos="notext" data-theme="c" data-mini="false"><span class="ui-btn-inner"><span class="ui-btn-text">clear text</span><span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span></span></a></div></div>
      <div data-role="none" class="ui-hide-label ui-field-contain ui-body ui-br"><label for="Title" class="ui-input-text">Title</label><div class="ui-input-search ui-shadow-inset ui-btn-corner-all ui-btn-shadow ui-icon-searchfield ui-body-c"><input type="text" data-role="none" data-type="search" name="Title" id="Title" value="" placeholder="Title" class="ui-input-text ui-body-c"><a href="#" class="ui-input-clear ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-fullsize ui-btn-icon-notext ui-input-clear-hidden" title="clear text" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-icon="delete" data-iconpos="notext" data-theme="c" data-mini="false"><span class="ui-btn-inner"><span class="ui-btn-text">clear text</span><span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span></span></a></div></div>
      <div data-role="none" class="ui-hide-label ui-field-contain ui-body ui-br"><label for="ReportNumber" class="ui-input-text">Report number</label><div class="ui-input-search ui-shadow-inset ui-btn-corner-all ui-btn-shadow ui-icon-searchfield ui-body-c"><input type="text" data-role="none" data-type="search" name="ReportNumber" id="ReportNumber" value="" placeholder="Report number" class="ui-input-text ui-body-c"><a href="#" class="ui-input-clear ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-fullsize ui-btn-icon-notext ui-input-clear-hidden" title="clear text" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-icon="delete" data-iconpos="notext" data-theme="c" data-mini="false"><span class="ui-btn-inner"><span class="ui-btn-text">clear text</span><span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span></span></a></div></div>
      <div data-role="none" class="ui-hide-label ui-field-contain ui-body ui-br"><label for="Affiliation" class="ui-input-text">Affiliation</label><div class="ui-input-search ui-shadow-inset ui-btn-corner-all ui-btn-shadow ui-icon-searchfield ui-body-c"><input type="text" data-role="none" data-type="search" name="Affiliation" id="Affiliation" value="" placeholder="Affiliation" class="ui-input-text ui-body-c"><a href="#" class="ui-input-clear ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-fullsize ui-btn-icon-notext ui-input-clear-hidden" title="clear text" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-icon="delete" data-iconpos="notext" data-theme="c" data-mini="false"><span class="ui-btn-inner"><span class="ui-btn-text">clear text</span><span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span></span></a></div></div>
      <div data-role="none" class="ui-hide-label ui-field-contain ui-body ui-br"><label for="Collaboration" class="ui-input-text">Collaboration</label><div class="ui-input-search ui-shadow-inset ui-btn-corner-all ui-btn-shadow ui-icon-searchfield ui-body-c"><input type="text" data-role="none" data-type="search" name="Collaboration" id="Collaboration" value="" placeholder="Collaboration" class="ui-input-text ui-body-c"><a href="#" class="ui-input-clear ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-fullsize ui-btn-icon-notext ui-input-clear-hidden" title="clear text" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-icon="delete" data-iconpos="notext" data-theme="c" data-mini="false"><span class="ui-btn-inner"><span class="ui-btn-text">clear text</span><span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span></span></a></div></div>
      <div data-role="none" class="ui-hide-label ui-field-contain ui-body ui-br"><label for="Keywords" class="ui-input-text">Keywords</label><div class="ui-input-search ui-shadow-inset ui-btn-corner-all ui-btn-shadow ui-icon-searchfield ui-body-c"><input type="text" data-role="none" data-type="search" name="Keywords" id="Keywords" value="" placeholder="Keywords" class="ui-input-text ui-body-c"><a href="#" class="ui-input-clear ui-btn ui-btn-up-c ui-shadow ui-btn-corner-all ui-fullsize ui-btn-icon-notext ui-input-clear-hidden" title="clear text" data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-icon="delete" data-iconpos="notext" data-theme="c" data-mini="false"><span class="ui-btn-inner"><span class="ui-btn-text">clear text</span><span class="ui-icon ui-icon-delete ui-icon-shadow">&nbsp;</span></span></a></div></div>
      <div data-corners="true" data-shadow="true" data-iconshadow="true" data-wrapperels="span" data-theme="b" data-disabled="false" class="ui-submit ui-btn ui-btn-up-b ui-shadow ui-btn-corner-all" aria-disabled="false"><span class="ui-btn-inner"><span class="ui-btn-text">Search</span></span><input name="search" data-role="none" type="submit" value="Search" data-theme="b" data-role="button" class="ui-btn-hidden" data-disabled="false"></div>
</form>
<!--   /jquery mobile pregenerated form   -->

<script>
document.addEventListener("deviceready", onDeviceReady, false);

function onDeviceReady(){
	//
	// Clean temporary files on startup
	// =================================
	
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFileSystemSuccess, fail);
	function onFileSystemSuccess(fileSystem) {
		
		//Read only the recorder folder
		var directoryReader = fileSystem.root.createReader();
		
		directoryReader.readEntries(
			function(entries){
			for(var i=0; i<entries.length; ++i){ 
				var entry = entries[i];
				if( entry.isDirectory && entry.name == 'tmp' )
				{
				
					var directoryReader = entry.createReader();
					directoryReader.readEntries(function(files){
						for(var i=0; i<files.length; ++i){ // sort entries
							var file = files[i];						
							file.getMetadata(function (metadata) {
								var oneHour = 60*60*1000; 	
								var today = new Date();
								var todayInt = today.getTime();
								var fileInt= metadata.modificationTime.getTime();
								var diffHours = Math.round(Math.abs((todayInt-fileInt)/(oneHour)));
								if(diffHours>=INVENIO_CACHE_DURATION)
									entry.remove(null, function(error){console.log('Error removing file: ' + error.code);});
								;
							}, null)
						}
						})
					}
				}
			}
		)
	}
	function fail(evt) {
		console.log(evt.target.error.code);
	}
}
 function localInit() {		
	$(".top_icons").show();
	
	$(".main_search_form").on("submit",function(e){
		//
		// Before search submit
		// =====================
		
		e.preventDefault();
		var request = "";
		if($(".main_search_form #Author").val()!="")
			request += " AND author:"+$(".main_search_form #Author").val();
			
		if($(".main_search_form #Title").val()!="")
			request += " AND title:"+$(".main_search_form #Title").val();
			
		if($(".main_search_form #ReportNumber").val()!="")
			request += " AND reportnumber:"+$(".main_search_form #ReportNumber").val();
			
		if($(".main_search_form #Affiliation").val()!="")
			request += " AND affiliation:"+$(".main_search_form #Affiliation").val();
			
		if($(".main_search_form #Collaboration").val()!="")
			request += " AND collaboration:"+$(".main_search_form #Collaboration").val();
			
		if($(".main_search_form #Keywords").val()!="")
			request += " AND keywords:"+$(".main_search_form #Keywords").val();
			
		sessionStorage.q = $.trim(request.substring(5));
		
		 window.location.href = "#page=search&domain="+config.id+"&q="+encodeURI(sessionStorage.q);	
	})
}
</script>